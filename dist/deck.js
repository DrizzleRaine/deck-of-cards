var deck=function(b){'use strict';let c=a=>b=>Math.pow(b,a),d=a=>b=>1-Math.abs(Math.pow(b-1,a)),e=a=>b=>b<0.5?c(a)(b*2)/2:d(a)(b*2-1)/2+0.5,f=a=>a,g=c(2),h=d(2),j=e(2),k=c(3),l=d(3),m=e(3),n=c(4),o=d(4),p=e(4),q=c(5),r=d(5),s=e(5),u=a=>1+Math.sin(Math.PI/2*a-Math.PI/2),v=a=>Math.sin(Math.PI/2*a),w=a=>(1+Math.sin(Math.PI*a-Math.PI/2))/2,A=a=>{let b=7.5625,c=2.75;if(a<1/c){return b*a*a}if(a<2/c){a-=1.5/c;return b*a*a+0.75}if(a<2.5/c){a-=2.25/c;return b*a*a+0.9375}a-=2.625/c;return b*a*a+0.984375},B=a=>1-A(1-a),C=a=>a<0.5?B(a*2)*0.5:A(a*2-1)*0.5+0.5;var D={linear:f,quadIn:g,quadOut:h,quadInOut:j,cubicIn:k,cubicOut:l,cubicInOut:m,quartIn:n,quartOut:o,quartInOut:p,quintIn:q,quintOut:r,quintInOut:s,sineIn:u,sineOut:v,sineInOut:w,bounceIn:B,bounceOut:A,bounceInOut:C};let{requestAnimationFrame:E}=window,F=[],G=1,H=()=>{if(!F.length){return}let a=Date.now();for(let b=0;b<F.length;b++){let c=F[b],{start:d,end:e,duration:f,easing:g,props:h}=c,{current:i}=h;if(a<d){continue}let j=a>e?1:(a-d)/f;c.tick(g(j));j===1&&F.splice(b--,1);c.handler&&c.handler(i,j)}F.length&&E(H)};var I=(({from:a,to:b,easing:c,duration:d,delay:e = 0},f)=>{let g=Date.now(),h=g+e*G,i=h+d*G;F.length||E(H);F.push(new J({from:a,to:b,start:h,end:i,duration:d,easing:c,handler:f}))});class J{constructor({from:a,to:b,start:c,end:d,duration:e,easing:f,handler:g}){this.from=a;this.to=b;this.start=c;this.end=d;this.duration=e*G;this.easing=D[f||'quadOut'];this.handler=g;this.started=!1;this.props={from:{},to:{},current:{},delta:{}}}parseProps(){let{from:a,to:b,props:c}=this;for(const d in a){if(d in b){let e=a[d],f=b[d];typeof e==='function'?(c.from[d]=e()):(c.from[d]=e);typeof f==='function'?(c.to[d]=f()):(c.to[d]=f);c.delta[d]=c.to[d]-c.from[d]}}}tick(a){let{started:b,props:c}=this,{current:d,to:e,delta:f}=c;b||this.parseProps();for(const b in e)d[b]=e[b]-f[b]*(1-a)}}var K=35,L=46,M=0,N=1,O=2,P=function(a){var b=null,c=null,d=null,e=M,f=0;for(var g=0;g<=a.length;g++){var h=a.charCodeAt(g),i=h===K,j=h===L,k=!h;(i||j||k)&&(e===M?(g===0?(b='div'):(b=a.substring(f,g))):e===N?(c=a.substring(f,g)):d?(d+=' '+a.substring(f,g)):(d=a.substring(f,g)),i?(e=N):j&&(e=O),f=g+1)}return{tag:b,id:c,className:d}},Q=function(a,b){var c=P(a),d=c.tag,e=c.id,f=c.className,g=b?document.createElementNS(b,d):document.createElement(d);e&&(g.id=e);f&&(b?g.setAttribute('class',f):(g.className=f));return g},R=function(a,b){var c=af(a),d=af(b);b===d&&d.__redom_view&&(b=d.__redom_view);d.parentNode&&(S(b,d,c),c.removeChild(d));return b},S=function(a,b,c){var d=b.__redom_lifecycle;if(T(d)){b.__redom_mounted=!1;return}var e=c;b.__redom_mounted&&Y(b,'onunmount');while(e){var f=e.__redom_lifecycle||{};for(var g in d)f[g]&&(f[g]-=d[g]);T(f)&&(e.__redom_lifecycle=null);e=e.parentNode}},T=function(a){if(a==null){return !0}for(var b in a){if(a[b]){return !1}}return !0},U=['onmount','onremount','onunmount'],V=typeof window!=='undefined'&&'ShadowRoot' in window,W=function(a,b,c,d){var e=af(a),f=af(b);b===f&&f.__redom_view&&(b=f.__redom_view);b!==f&&(f.__redom_view=b);var g=f.__redom_mounted,h=f.parentNode;g&&h!==e&&S(b,f,h);c!=null?(d?e.replaceChild(f,af(c)):e.insertBefore(f,af(c))):e.appendChild(f);X(b,f,e,h);return b},X=function(a,b,c,d){var e=b.__redom_lifecycle||(b.__redom_lifecycle={}),f=c===d,g=!1;for(var h=0,i=U;h<i.length;h+=1){var j=i[h];f||(a!==b&&(j in a&&(e[j]=(e[j]||0)+1)));e[j]&&(g=!0)}if(!g){b.__redom_mounted=!0;return}var k=c,l=!1;(f||k&&k.__redom_mounted)&&(Y(b,f?'onremount':'onmount'),l=!0);while(k){var m=k.parentNode,n=k.__redom_lifecycle||(k.__redom_lifecycle={});for(var o in e)n[o]=(n[o]||0)+e[o];if(l){break}else (k===document||V&&k instanceof window.ShadowRoot||m&&m.__redom_mounted)&&(Y(k,f?'onremount':'onmount'),l=!0),k=m}},Y=function(a,b){b==='onmount'||b==='onremount'?(a.__redom_mounted=!0):b==='onunmount'&&(a.__redom_mounted=!1);var c=a.__redom_lifecycle;if(!c){return}var d=a.__redom_view,e=0;d&&d[b]&&d[b]();for(var f in c)f&&e++;if(e){var g=a.firstChild;while(g){var h=g.nextSibling;Y(g,b);g=h}}},Z=function(a,b,c){var d=af(a);if(c!==undefined)d.style[b]=c;else if(ag(b))d.setAttribute('style',b);else{for(var e in b)Z(d,e,b[e])}},_='http://www.w3.org/1999/xlink',$=function(a,b,c){var d=af(a),e=d instanceof SVGElement;if(c!==undefined){if(b==='style')Z(d,c);else if(e&&ah(c))d[b]=c;else if(b==='dataset')ab(d,c);else if(!e&&(b in d||ah(c)))d[b]=c;else{if(e&&b==='xlink'){aa(d,c);return}d.setAttribute(b,c)}}else{for(var f in b)$(d,f,b[f])}};function aa(a,b){for(var c in b)a.setAttributeNS(_,c,b[c])}function ab(a,b){for(var c in b)a.dataset[c]=b[c]}var ac=function(a){return document.createTextNode(a!=null?a:'')},ad=function(a,b){for(var c=0,d=b;c<d.length;c+=1){var e=d[c];if(e!==0&&!e){continue}var f=typeof e;f==='function'?e(a):f==='string'||f==='number'?a.appendChild(ac(e)):ai(af(e))?W(a,e):e.length?ad(a,e):f==='object'&&$(a,e)}},ae=function(a){return ag(a)?al(a):af(a)},af=function(a){return a.nodeType&&a||!a.el&&a||af(a.el)},ag=function(a){return typeof a==='string'},ah=function(a){return typeof a==='function'},ai=function(a){return a&&a.nodeType},aj={},ak=function(a){return aj[a]||(aj[a]=Q(a))},al=function(a){var b=[],c=arguments.length-1;while(c-->0)b[c]=arguments[c+1];var d;if(ag(a))d=ak(a).cloneNode(!1);else if(ai(a))d=a.cloneNode(!1);else if(ah(a)){var e=a;d=new (Function.prototype.bind.apply(e,[null].concat(b)))()}else{throw new Error('At least one argument required')};ad(af(d),b);return d};al.extend=function(a){var b=[],c=arguments.length-1;while(c-->0)b[c]=arguments[c+1];var d=ak(a);return al.bind.apply(al,[this,d].concat(b))};var am=al,an=function(a){var b=[],c=arguments.length-1;while(c-->0)b[c]=arguments[c+1];var d=af(a),e=ao(a,b,d.firstChild);while(e){var f=e.nextSibling;R(a,e);e=f}};function ao(a,b,c){var d=c,e=new Array(b.length);for(var f=0;f<b.length;f++)e[f]=b[f]&&af(b[f]);for(var g=0;g<b.length;g++){var h=b[g];if(!h){continue}var i=e[g];if(i===d){d=d.nextSibling;continue}if(ai(i)){var j=d&&d.nextSibling,k=h.__redom_index!=null,l=k&&j===e[g+1];W(a,h,d,l);l&&(d=j);continue}h.length!=null&&(d=ao(a,h,d))}return d}var ap=function(a){return function(b){return b[a]}},aq=function d(a,b,c){this.View=a;this.initData=c;this.oldLookup={};this.lookup={};this.oldViews=[];this.views=[];b!=null&&(this.lookup={},this.key=ah(b)?b:ap(b))};aq.prototype.update=function c(a,b){var d=this,e=d.View,f=d.key,g=d.initData,h=f!=null,i=this.lookup,j={},k=new Array(a.length),l=this.views;for(var m=0;m<a.length;m++){var n=a[m],o=void 0;if(h){var p=f(n);o=i[p]||new e(g,n,m,a);j[p]=o;o.__redom_id=p}else o=l[m]||new e(g,n,m,a);o.update&&o.update(n,m,a,b);var q=af(o.el);q.__redom_view=o;k[m]=o}this.oldViews=l;this.views=k;this.oldLookup=i;this.lookup=j};var ar=function(a,b,c,d){return new as(a,b,c,d)},as=function e(a,b,c,d){this.__redom_list=!0;this.View=b;this.initData=d;this.views=[];this.pool=new aq(b,c,d);this.el=ae(a);this.keySet=c!=null};as.prototype.update=function c(a,b){var d=this;a===void 0&&(a=[]);var e=this,f=e.keySet,g=this.views;this.pool.update(a,b);var h=this.pool,i=h.views,j=h.lookup;if(f){for(var k=0;k<g.length;k++){var l=g[k],m=l.__redom_id;j[m]==null&&(l.__redom_index=null,R(d,l))}}for(var n=0;n<i.length;n++){var o=i[n];o.__redom_index=n}an(this,i);f&&(this.lookup=j);this.views=i};as.extend=function(a,b,c,d){return as.bind(as,a,b,c,d)};ar.extend=as.extend;let at='spade heart club diamond'.split(' '),au='A 2 3 4 5 6 7 8 9 10 J Q K'.split(' '),av=[[[0,0]],[[0,-1],[0,1,!0]],[[0,-1],[0,0],[0,1,!0]],[[-1,-1],[1,-1],[-1,1,!0],[1,1,!0]],[[-1,-1],[1,-1],[0,0],[-1,1,!0],[1,1,!0]],[[-1,-1],[1,-1],[-1,0],[1,0],[-1,1,!0],[1,1,!0]],[[-1,-1],[1,-1],[0,-0.5],[-1,0],[1,0],[-1,1,!0],[1,1,!0]],[[-1,-1],[1,-1],[0,-0.5],[-1,0],[1,0],[0,-0.5],[-1,1,!0],[1,1,!0]],[[-1,-1],[1,-1],[-1,-0.3333333333333333],[1,-0.3333333333333333],[0,0],[-1,0.3333333333333333,!0],[1,0.3333333333333333,!0],[-1,1,!0],[1,1,!0]],[[-1,-1],[1,-1],[0,-0.6666666666666666],[-1,-0.3333333333333333],[1,-0.3333333333333333],[-1,0.3333333333333333,!0],[1,0.3333333333333333,!0],[0,0.6666666666666666,!0],[-1,1,!0],[1,1,!0]],[[0,0]],[[0,0]],[[0,0]]];class aw{constructor(a){this.el=am('.card',this.container=am('.card-container',this.front=am(".card-front",this.suits=ar('.card-suits',ax),am('.card-tl',this.rank1=am('.card-rank'),this.suit1=am('.card-suit')),am('.card-br',this.rank2=am('.card-rank'),this.suit2=am('.card-suit'))),this.back=am('.card-back',this.backTexture=am('.card-back-texture'))));this.setIndex(a%52);this.side='front'}setIndex(a){if(a==null){this.front.className='card-front';this.suits.update([]);this.rank1.textContent='';this.rank2.textContent='';this.suit1.textContent='';this.suit2.textContent='';return}this.index=a;let b=Math.floor(a/13)%4,c=a%13,d=Math.floor(a/13)%2?'red':'black',e=c===0,f=c>9;d==='red'?(this.front.classList.add('red'),this.front.classList.remove('black')):(this.front.classList.add('black'),this.front.classList.remove('red'));this.value=c+1;this.suits.update(av[c],{suit:b,value:c,color:d,ace:e,royal:f});this.rank1.textContent=au[c];this.rank2.textContent=au[c];this.suit1.style.backgroundImage=`url(img/${at[b]}.svg)`;this.suit2.style.backgroundImage=`url(img/${at[b]}.svg)`}set({x:a = this.x,y:b = this.y,z:c = this.z}){this.x=a;this.y=b;this.z=c;this._set({x:a,y:b,z:c})}_set({x:a = this.x,y:b = this.y,z:c = this.z}){this.el.style.transform=`translate(${a*5-c/52}em, ${b*7-c/52}em)`}animateTo({x:a,y:b,z:c,delay:d = 0,duration:e = 200,easing:f = 'quartInOut'},g,h){I({from:{x:a,y:b,z:c},to:{x:a,y:b,z:c},delay:d,duration:e,easing:f},({x:a,y:b,z:c},d)=>{this.set({x:a,y:b,z:c});h&&h(d);g&&d===1&&g()})}get side(){return this._side}set side(a){if(a===this._side){return}a==='front'?(this.back.style.display='none',W(this.container,this.front)):(R(this.container,this.front),this.back.style.display='');this._side=a}flipTo(a,{side:b,delay:c = 0}){return new Promise(async d=>{if(this.side===b){return}let e=this.y;await new Promise(a=>{I({from:{y:e},to:{y:e+1},delay:c,duration:150,easing:'cubicInOut'},({y:b},c)=>{this.set({y:b});c===1&&a()})});a.push(this);this.set({y:e+1});await new Promise(a=>{I({from:{y:e+1},to:{y:e},duration:150,easing:'cubicInOut'},({y:c},d)=>{this.set({y:c});d>0.45&&(this.side!==b&&(this.side=b));d===1&&a()})});this.side=b;d()})}dealTo(a,{side:b,delay:c,index:d = this.parent.cards.indexOf(this)}){return this.parent.dealTo(a,{side:b,delay:c,index:d})}}aw.create=(a,b)=>{return new aw(a,b)};class ax{constructor(){this.el=am('.card-suit')}update(a,b,c,{value:d,suit:e,ace:f,royal:g}){g?(this.el.textContent=au[d],this.el.style.backgroundImage=''):(this.el.textContent='',this.el.style.backgroundImage=`url(img/${at[e]}.svg)`);this.el.className=f?'card-suit ace':g?'card-suit royal':'card-suit';this.el.style.left=`${a[0]*100}%`;this.el.style.top=`${a[1]*100}%`;this.el.style.transform=`translate(-50%, -50%) rotate(${!!a[2]*180}deg)`;this.el.style.fontWeight=g?'300':''}}var ay=(async(a,b,c,{side:d,duration:e = 300,delay:f = 0},g)=>{let h={x:b.x,y:b.y,z:b.z},i=c.getPosition(c.cards.length),j={x:h.x-i.x,y:h.y-i.y,z:h.z-i.z},k={x:a.x-c.x,y:a.y-c.y,z:a.z-c.z},l={x:b.x-k.x/2-j.x/2,y:b.y-k.y/2-j.y/2};await new Promise(a=>{I({from:{x:b.x,y:b.y},to:l,easing:'quartIn',delay:f,duration:e/2},({x:c,y:d},e)=>{b.set({x:c,y:d});e===1&&a()})});a.remove(b);c.push(b);let m={x:b.x+k.x/2+j.x/2,y:b.y+k.y/2+j.y/2,z:b.z+k.z+j.z};b._set(m);I({from:m,to:{z:b.z},delay:0,duration:e/2,easing:'quadIn'},({z:a})=>{b.z=a});await new Promise(a=>{I({from:m,to:{x:b.x,y:b.y},delay:0,duration:e/2,easing:'quartOut'},({x:c,y:e},f)=>{b.set({x:c,y:e});f>0.55&&(d&&b.side!==d&&(b.side=d));f===1&&(g&&g(),a())})})}),az=(a=>{for(let b=a.length-1;b;b--){let c=Math.random()*b|0,d=a[b];a[b]=a[c];a[c]=d}return a}),aA=(async(a,b)=>{await aB(a);await aB(a);await aB(a)});let aB=a=>{let b=a.cards.map(a=>a.index);az(b);return new Promise(async(c,d)=>{let e=[],f=[];while(a.cards.length){let b=a.cards.shift();Math.random()>0.5?e.push(b):f.push(b)}let g=[];while(e.length||f.length){let b={x:0.4+Math.random()*0.3},c;e[0]&&f[0]?(Math.random()>0.5?(c=e.shift(),b.x*=-1):(c=f.shift())):e[0]?(c=e.shift(),b.x*=-1):f[0]&&(c=f.shift());a.cards.push(c);g.push({card:c,to:b})}g.forEach(async({card:d,to:e},f)=>{let{x:h}=e;I({delay:f/g.length*175,duration:275,from:{z:d.z},to:{z:f},easing:'linear'},({z:a},c)=>{d.z=a;c===1&&d.setIndex(b[f])});await new Promise(b=>{I({delay:f/g.length*175,duration:175,easing:'cubicOut',from:{x:d.x},to:{x:h}},({x:c},e)=>{d.set({x:c});if(e===1){if(f===0){let b=a.el.firstChild;d.el!==b.previousSibling&&a.el.insertBefore(d.el,b)}else{let b=g[f-1].card.el.nextSibling;b?(b.previousSibling!==d.el&&a.el.insertBefore(d.el,b)):a.el.appendChild(d.el)}b()}})});I({delay:0,duration:200,easing:'cubicInOut',from:{x:d.x},to:{x:0}},({x:a},b)=>{d.set({x:a});b===1&&(f===g.length-1&&c())})})})};class aC{constructor({x:a = 0,y:b = 0,z:c = 0} = {}){this.el=am('.deck');this.cards=[];this.generate(52);this.set({x:a,y:b,z:c})}set({x:a = this.x,y:b = this.y,z:c = this.z}){this.x=a;this.y=b;this.z=c;this.el.style.transform=`translate(${a*5-c/52}em, ${b*7-c/52}em)`}animateTo({x:a = this.x,y:b = this.y,z:c = this.z,delay:d = 0,duration:e = 400,easing:f = 'cubicInOut'},g,h){return new Promise(i=>{I({from:{x:this.x,y:this.y,z:this.z},to:{x:a,y:b,z:c},delay:d,duration:e,easing:f},({x:a,y:b,z:c},d)=>{this.set({x:a,y:b,z:c});h&&h(d);d===1&&(g&&g(),i())})})}generate(a){for(let b=0;b<a;b++){let c=new aw(a-1-b);this.push(c)}}getPosition(a){let b=0,c=0,d=a;return{x:b,y:c,z:d}}remove(a){for(let b=0;b<this.cards.length;b++)this.cards[b]===a&&this.cards.splice(b--,1)}push(a){a.parent&&a.parent.remove(a);this.cards.push(a);a.parent=this;this.el.appendChild(a.el);for(let a=0;a<this.cards.length;a++){let{x:b,y:c,z:d}=this.getPosition(a);this.cards[a].set({x:b,y:c,z:d})}}shuffle(){return aA(this)}dealTo(a,{side:b,delay:c = 0,index:d = this.cards.length-1,moveDeck:e = !1} = {},f){return new Promise(async g=>{e&&(await this.animateTo({x:a.x+(a.rotate?-1:1)*a.cards.length*a.spread,y:a.y+1,duration:250,delay:c}));await ay(this,this.cards[d],a,{duration:200,side:b,delay:e?0:c},f);g()})}}class aD{constructor({x:a = 0,y:b = 0,z:c = 0,rotate:d = !1,spread:e = 0.16666666666666666} = {}){this.el=am('.hand');this.cards=[];this.rotate=d;this.spread=e;this.set({x:a,y:b,z:c})}set({x:a = this.x,y:b = this.y,z:c = this.z,r:d = this.r}){this.x=a;this.y=b;this.z=c;this.el.style.transform=`translate(${a*5-c/52}em, ${b*7-c/52}em)`}animateTo({x:a = this.x,y:b = this.y,z:c = this.z,delay:d = 0,duration:e = 500,easing:f = 'quartInOut'},g){return new Promise(h=>{I({from:{x:this.x,y:this.y,z:this.z},to:{x:a,y:b,z:c},delay:d,duration:e,easing:f},({x:a,y:b,z:c},d)=>{this.set({x:a,y:b,z:c});g&&g(d);d===1&&h()})})}getPosition(a){let b=(this.rotate?-1:1)*a*this.spread,c=0,d=a;return{x:b,y:c,z:d}}remove(a){for(let b=0;b<this.cards.length;b++)this.cards[b]===a&&this.cards.splice(b--,1)}push(a){a.parent&&a.parent.remove(a);this.cards.push(a);this.el.appendChild(a.el);a.parent=this;for(let a=0;a<this.cards.length;a++){let{x:b,y:c,z:d}=this.getPosition(a);this.cards[a].set({x:b,y:c,z:d})}}dealTo(a,{side:b,delay:c = 0,index:d = this.cards.length-1,moveDeck:e = !1} = {},f){return new Promise(async g=>{e&&(await this.animateTo({x:a.x+(a.rotate?-1:1)*a.cards.length*a.spread,y:a.y+1,duration:250,delay:c}));await ay(this,this.cards[d],a,{duration:250,side:b,delay:e?0:c},f);g()})}flip(a,b,{side:c,delay:d = 0},e){return this.cards[a].flipTo(b,{side:c,delay:d},e)}}var aE=(a=>{return new Promise(b=>{a.cards.forEach((c,d)=>{c.el.style.opacity=0;I({delay:300+d/a.cards.length*750,duration:400,from:{opacity:0,y:-2,x:0},to:{opacity:1,y:0,x:0},easing:'cubicInOut'},({x:e,y:f,opacity:g},h)=>{c.el.style.opacity=g===1?'':g;c.set({x:e,y:f});h>0.55&&(c.side==='front'&&(c.side='back'));h===1&&(d===a.cards.length-1&&b())})})})});class aF{constructor(){this.el=am('.scene')}append(a){W(this.el,a.el)}}b.animate=I;b.Card=aw;b.deal=ay;b.Deck=aC;b.fisherYates=az;b.Hand=aD;b.intro=aE;b.Scene=aF;b.shuffle=aA;return b}({})
